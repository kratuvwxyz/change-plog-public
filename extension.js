const vscode=require("vscode");let hasRun=!1;function activate(e){let t=vscode.workspace.onDidChangeTextDocument((e=>{if(hasRun)return;const t=vscode.window.activeTextEditor;if(!t)return;if(!e.contentChanges||0===e.contentChanges.length)return;const n=e.document,a=t.selection.active;if(a.line<0)return;let i=n.lineAt(a.line).text.trim().match(/^cl-(ma|mi|pa)-(added|changed|deprecated|fixed|removed|secured)-(.+?)--$/);i&&(hasRun=!0,updateChangelog(t,n,i[1],i[2],i[3],a.line))}));e.subscriptions.push(t)}function updateChangelog(e,t,n,a,i,o){const s=t.getText().split("\n"),r="# Changelog",d="| #     | Date                           | Type  | Change     |                                    |\n|-------|--------------------------------|-------|------------|------------------------------------|\n";let c=!1,l=!1;for(let e=0;e<s.length;e++)s.length>0&&s[e].trim()===r&&(c=!0),s.length>0&&s[e].startsWith("| #")&&s[e].includes("| Date")&&(l=!0);let g=0;g=l?6:4;let p=[0,0,0];if(l&&s.length>6){const e=s[6].match(/^\|\s*(\d+\.\d+\.\d+)\s*\|/);e&&(p=e[1].split(".").map((e=>parseInt(e,10))))}let u="";"ma"===n?(u="MAJOR",p[0]++,p[1]=0,p[2]=0):"mi"===n?(u="MINOR",p[1]++,p[2]=0):"pa"===n&&(u="PATCH",p[2]++);let h="";"ADDED"===a.toUpperCase()?h="ADDED     ":"CHANGED"===a.toUpperCase()?h="CHANGED   ":"DEPRECATED"===a.toUpperCase()?h="DEPRECATED":"FIXED"===a.toUpperCase()?h="FIXED     ":"REMOVED"===a.toUpperCase()?h="REMOVED   ":"SECURED"===a.toUpperCase()&&(h="SECURED   ");const D=p.join("."),C=new Date,E=`| ${D} | ${`${C.getFullYear().toString().slice(-2)}&#8209;${String(C.getMonth()+1).padStart(2,"0")}&#8209;${String(C.getDate()).padStart(2,"0")} <br>${String(C.getHours()).padStart(2,"0")}:${String(C.getMinutes()).padStart(2,"0")}`} | ${u} | ${h} | ${i} |`;e.edit((e=>{c||l?c?l?e.insert(new vscode.Position(g,0),E+"\n"):e.insert(new vscode.Position(g,0),d+E+"\n"):e.insert(new vscode.Position(0,0),r+"\n"):(e.insert(new vscode.Position(0,0),r+"\n"),e.insert(new vscode.Position(g,0),"\n\n\n"+d+E+"\n"))})).then((()=>{e.edit((e=>{0===o||1===o?e.delete(t.lineAt(1).range):2===o?e.delete(t.lineAt(2).range):3===o?e.delete(t.lineAt(3).range):e.delete(t.lineAt(o+1).range)})),hasRun=!1}))}function deactivate(){}module.exports={activate:activate,updateChangelog:updateChangelog,deactivate:deactivate};